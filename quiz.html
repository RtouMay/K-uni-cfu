<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<title>آزمون</title>

<style>
@font-face {
    font-family: "YekanBakh";
    src: url("YekanBakh.woff2") format("woff2");
}

* { box-sizing: border-box; }

:root {
    --bg-body: radial-gradient(circle at top, #1d1d27, #050509 60%, #000 100%);
    --text-main: #f6f6f6;
    --card-bg: #0f0f15;
    --card-shadow: 0 30px 90px rgba(0,0,0,.9);
    --item-bg: #111;
    --item-hover: rgba(245,200,66,.15);
    --border: rgba(255,255,255,.1);
    --gold: #f5c842;
    --right: #38d468;
    --wrong: #ff4a4a;
}

body[data-theme="light"] {
    --bg-body: radial-gradient(circle at top, #ffffff, #e9e9e9 60%, #dcdcdc);
    --text-main: #222;
    --card-bg: #ffffff;
    --card-shadow: 0 25px 60px rgba(0,0,0,.14);
    --item-bg: #f5f5f5;
    --item-hover: rgba(240,200,90,.18);
    --border: rgba(0,0,0,.1);
    --gold: #c59500;
    --right: #1eb650;
    --wrong: #e74343;
}

body {
    margin: 0;
    background: var(--bg-body);
    color: var(--text-main);
    font-family: "YekanBakh";
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
    overflow-x: hidden;
    transition: background .3s ease, color .3s ease;
}

/* کارت اصلی */
.card {
    width: 100%;
    max-width: 850px;
    background: var(--card-bg);
    border-radius: 28px;
    padding: 30px;
    box-shadow: var(--card-shadow);
    text-align: center;
    opacity: 0;
    transform: translateY(20px);
    animation: cardIn .7s ease forwards;
    position: relative;
    overflow: hidden;
}
@keyframes cardIn {
    to { opacity:1; transform: translateY(0); }
}

/* نور پشت کارت */
.card::before {
    content: "";
    position: absolute;
    width: 500px;
    height: 500px;
    top: -260px;
    left: -260px;
    background: radial-gradient(circle, rgba(245,200,66,.15), transparent 70%);
    animation: glowMove 8s infinite alternate ease-in-out;
    z-index: 0;
}
@keyframes glowMove {
    0% { transform: translate(0,0) scale(1); }
    100% { transform: translate(50px,50px) scale(1.25); }
}

.inside {
    position: relative;
    z-index: 5;
}

/* شمارنده سؤال */
.counter {
    font-size: 15px;
    margin-bottom: 16px;
    opacity: .9;
}

/* تایمر */
.timer-bar {
    width: 100%;
    height: 8px;
    border-radius: 999px;
    background: rgba(255,255,255,.15);
    margin-bottom: 22px;
    overflow: hidden;
}
.timer-fill {
    height: 100%;
    width: 100%;
    background: var(--gold);
    border-radius: 999px;
    transition: width .5s linear;
}

/* متن سؤال */
.question-box {
    font-size: 20px;
    line-height: 1.9;
    margin-bottom: 28px;
    min-height: 90px;
    opacity: 0;
    transform: translateY(12px);
    animation: fadeIn .5s forwards;
}
@keyframes fadeIn {
    to { opacity:1; transform: translateY(0); }
}

/* گزینه‌ها */
.options {
    display: flex;
    flex-direction: column;
    gap: 14px;
    margin-top: 20px;
}

.option {
    background: var(--item-bg);
    border: 1px solid var(--border);
    padding: 16px;
    border-radius: 18px;
    font-size: 16px;
    text-align: right;
    cursor: pointer;
    transition: .2s ease;
    opacity: 0;
    transform: translateY(14px);
}
.option:nth-child(1) { animation: fadeOption .5s ease forwards .1s; }
.option:nth-child(2) { animation: fadeOption .5s ease forwards .2s; }
.option:nth-child(3) { animation: fadeOption .5s ease forwards .3s; }
.option:nth-child(4) { animation: fadeOption .5s ease forwards .4s; }

@keyframes fadeOption {
    to { opacity:1; transform: translateY(0); }
}

.option:hover {
    background: var(--item-hover);
    transform: translateY(-3px);
    box-shadow: 0 12px 35px rgba(0,0,0,.35);
}

/* صحیح */
.correct {
    background: var(--right) !important;
    color: #fff;
    animation: pulseRight .5s ease;
}
@keyframes pulseRight {
    0% { transform: scale(1); }
    50% { transform: scale(1.04); }
    100% { transform: scale(1); }
}

/* غلط */
.wrong {
    background: var(--wrong) !important;
    color: #fff;
    animation: shake .45s ease;
}
@keyframes shake {
    0%,100% { transform: translateX(0); }
    20% { transform: translateX(-6px); }
    40% { transform: translateX(6px); }
    60% { transform: translateX(-5px); }
    80% { transform: translateX(5px); }
}

/* صفحه ترنزیشن */
.page-transition {
    position: fixed;
    inset: 0;
    background: black;
    opacity: 0;
    pointer-events:none;
    transition: .4s ease;
    z-index: 9999;
}
.page-transition.active {
    opacity: 1;
    pointer-events: all;
}

</style>
</head>

<body>

<div id="transitionLayer" class="page-transition"></div>

<div class="card">
    <div class="inside">

        <div id="counter" class="counter">سؤال 1</div>

        <div class="timer-bar">
            <div id="timerFill" class="timer-fill"></div>
        </div>

        <div id="questionBox" class="question-box"></div>

        <div id="optionsBox" class="options"></div>

    </div>
</div>


<script>
/* تم */
const theme = localStorage.getItem("konkur_theme") || "dark";
document.body.setAttribute("data-theme", theme);

/* داده‌ها */
const questionCount = Number(localStorage.getItem("konkur_questionCount")) || 10;
const subject = localStorage.getItem("konkur_subject");

/* فرض می‌کنیم JSON سوالات قبلاً لود شده */
let questionsData = []; 
let currentIndex = 0;
let correctCount = 0;
let wrongCount = 0;

/* شبیه‌سازی لود سوالات (تو واقعی PDF parse می‌کنیم) */
for (let i = 1; i <= questionCount; i++) {
    questionsData.push({
        question: "این یک سؤال نمونه است شماره " + i,
        options: [
            "گزینه اول",
            "گزینه دوم",
            "گزینه سوم",
            "گزینه چهارم"
        ],
        answer: Math.floor(Math.random() * 4)
    });
}

const qBox = document.getElementById("questionBox");
const optBox = document.getElementById("optionsBox");
const timerFill = document.getElementById("timerFill");
const counter = document.getElementById("counter");

/* زمان هر سؤال */
let timer = 18;
let timerInterval;

/* شروع سؤال */
function loadQuestion() {
    const q = questionsData[currentIndex];

    /* شمارنده */
    counter.textContent = `سؤال ${currentIndex+1} از ${questionCount}`;

    /* تایمر */
    resetTimer();

    /* انیمیشن سوال */
    qBox.style.opacity = 0;
    qBox.style.transform = "translateY(12px)";
    setTimeout(() => {
        qBox.textContent = q.question;
        qBox.style.animation = "none";
        void qBox.offsetWidth;
        qBox.style.animation = "fadeIn .5s forwards";
    }, 20);

    /* گزینه‌ها */
    optBox.innerHTML = "";
    q.options.forEach((opt, i) => {
        const div = document.createElement("div");
        div.className = "option";
        div.textContent = opt;

        div.onclick = () => selectAnswer(i);

        optBox.appendChild(div);
    });
}

/* انتخاب پاسخ */
let locked = false;
function selectAnswer(i) {
    if (locked) return;
    locked = true;

    const q = questionsData[currentIndex];
    const opts = document.querySelectorAll(".option");

    /* صحیح یا غلط */
    opts.forEach((el, idx) => {
        if (idx === q.answer) {
            el.classList.add("correct");
        }
        if (idx === i && idx !== q.answer) {
            el.classList.add("wrong");
        }
    });

    if (i === q.answer) {
        correctCount++;
    } else {
        wrongCount++;
    }

    /* بعد از یک لحظه → سوال بعدی */
    setTimeout(() => {
        currentIndex++;
        if (currentIndex >= questionsData.length) {
            finishQuiz();
        } else {
            locked = false;
            loadQuestion();
        }
    }, 950);
}

/* تایمر */
function resetTimer() {
    clearInterval(timerInterval);
    timer = 18;
    timerFill.style.width = "100%";

    timerInterval = setInterval(() => {
        timer--;
        const percent = (timer / 18) * 100;
        timerFill.style.width = percent + "%";

        if (timer <= 0) {
            clearInterval(timerInterval);
            wrongCount++;
            currentIndex++;
            if (currentIndex >= questionsData.length) finishQuiz();
            else loadQuestion();
        }
    }, 1000);
}

/* پایان آزمون */
function finishQuiz() {
    clearInterval(timerInterval);

    /* ذخیره در localStorage */
    localStorage.setItem("quiz_correct", correctCount);
    localStorage.setItem("quiz_wrong", wrongCount);

    const layer = document.getElementById("transitionLayer");
    layer.classList.add("active");

    setTimeout(() => {
        window.location.href = "result.html";
    }, 400);
}

loadQuestion();
</script>

</body>
</html>
